***************
** Arguments **
***************
backbone: 
calibration: True
config_file: configs/trainers/CoOp/rn50.yaml
cutrate: 0.15
dataset_config_file: configs/datasets/dtd.yaml
eval_only: True
head: 
load_epoch: None
model_dir: 
no_train: False
opts: []
output_dir: output/ZeroshotCLIP3/rn50/dtd
relevance_refine: False
resume: 
root: /ix/yufeihuang/jia/nlp/prompt/data
seed: -1
source_domains: None
target_domains: None
trainer: ZeroshotCLIP3
transforms: None
vb_dir: /ihome/yufeihuang/jiy130/Prompt/CoOp/knowledgebase
vbsize: 10
verbalizer: True
************
** Config **
************
CALIBRATION: True
CALIBRATION_CUT: 0.15
DATALOADER:
  K_TRANSFORMS: 1
  NUM_WORKERS: 8
  RETURN_IMG0: False
  TEST:
    BATCH_SIZE: 100
    SAMPLER: SequentialSampler
  TRAIN_U:
    BATCH_SIZE: 32
    N_DOMAIN: 0
    N_INS: 16
    SAME_AS_X: True
    SAMPLER: RandomSampler
  TRAIN_X:
    BATCH_SIZE: 32
    N_DOMAIN: 0
    N_INS: 16
    SAMPLER: RandomSampler
DATASET:
  ALL_AS_UNLABELED: False
  CIFAR_C_LEVEL: 1
  CIFAR_C_TYPE: 
  NAME: DescribableTextures
  NUM_LABELED: -1
  NUM_SHOTS: -1
  ROOT: /ix/yufeihuang/jia/nlp/prompt/data
  SOURCE_DOMAINS: ()
  STL10_FOLD: -1
  SUBSAMPLE_CLASSES: all
  TARGET_DOMAINS: ()
  VAL_PERCENT: 0.1
INPUT:
  COLORJITTER_B: 0.4
  COLORJITTER_C: 0.4
  COLORJITTER_H: 0.1
  COLORJITTER_S: 0.4
  CROP_PADDING: 4
  CUTOUT_LEN: 16
  CUTOUT_N: 1
  GB_K: 21
  GB_P: 0.5
  GN_MEAN: 0.0
  GN_STD: 0.15
  INTERPOLATION: bicubic
  NO_TRANSFORM: False
  PIXEL_MEAN: [0.48145466, 0.4578275, 0.40821073]
  PIXEL_STD: [0.26862954, 0.26130258, 0.27577711]
  RANDAUGMENT_M: 10
  RANDAUGMENT_N: 2
  RGS_P: 0.2
  RRCROP_SCALE: (0.08, 1.0)
  SIZE: (224, 224)
  TRANSFORMS: ('random_resized_crop', 'random_flip', 'normalize')
MODEL:
  BACKBONE:
    NAME: RN50
    PRETRAINED: True
  HEAD:
    ACTIVATION: relu
    BN: True
    DROPOUT: 0.0
    HIDDEN_LAYERS: ()
    NAME: 
  INIT_WEIGHTS: 
OPTIM:
  ADAM_BETA1: 0.9
  ADAM_BETA2: 0.999
  BASE_LR_MULT: 0.1
  GAMMA: 0.1
  LR: 0.002
  LR_SCHEDULER: cosine
  MAX_EPOCH: 200
  MOMENTUM: 0.9
  NAME: sgd
  NEW_LAYERS: ()
  RMSPROP_ALPHA: 0.99
  SGD_DAMPNING: 0
  SGD_NESTEROV: False
  STAGED_LR: False
  STEPSIZE: (-1,)
  WARMUP_CONS_LR: 1e-05
  WARMUP_EPOCH: 1
  WARMUP_MIN_LR: 1e-05
  WARMUP_RECOUNT: True
  WARMUP_TYPE: constant
  WEIGHT_DECAY: 0.0005
OUTPUT_DIR: output/ZeroshotCLIP3/rn50/dtd
RELEVANCE_REFINE: False
RESUME: 
SEED: -1
TEST:
  COMPUTE_CMAT: False
  EVALUATOR: Classification
  FINAL_MODEL: last_step
  NO_TEST: False
  PER_CLASS_RESULT: False
  SPLIT: test
TRAIN:
  CHECKPOINT_FREQ: 0
  COUNT_ITER: train_x
  PRINT_FREQ: 5
TRAINER:
  CDAC:
    CLASS_LR_MULTI: 10
    P_THRESH: 0.95
    RAMPUP_COEF: 30
    RAMPUP_ITRS: 1000
    STRONG_TRANSFORMS: ()
    TOPK_MATCH: 5
  COCOOP:
    CTX_INIT: 
    N_CTX: 16
    PREC: fp16
  COOP:
    CLASS_TOKEN_POSITION: end
    CSC: False
    CTX_INIT: 
    N_CTX: 16
    PREC: fp16
  CROSSGRAD:
    ALPHA_D: 0.5
    ALPHA_F: 0.5
    EPS_D: 1.0
    EPS_F: 1.0
  DAEL:
    CONF_THRE: 0.95
    STRONG_TRANSFORMS: ()
    WEIGHT_U: 0.5
  DAELDG:
    CONF_THRE: 0.95
    STRONG_TRANSFORMS: ()
    WEIGHT_U: 0.5
  DDAIG:
    ALPHA: 0.5
    CLAMP: False
    CLAMP_MAX: 1.0
    CLAMP_MIN: -1.0
    G_ARCH: 
    LMDA: 0.3
    WARMUP: 0
  DOMAINMIX:
    ALPHA: 1.0
    BETA: 1.0
    TYPE: crossdomain
  ENTMIN:
    LMDA: 0.001
  FIXMATCH:
    CONF_THRE: 0.95
    STRONG_TRANSFORMS: ()
    WEIGHT_U: 1.0
  M3SDA:
    LMDA: 0.5
    N_STEP_F: 4
  MCD:
    N_STEP_F: 4
  MEANTEACHER:
    EMA_ALPHA: 0.999
    RAMPUP: 5
    WEIGHT_U: 1.0
  MIXMATCH:
    MIXUP_BETA: 0.75
    RAMPUP: 20000
    TEMP: 2.0
    WEIGHT_U: 100.0
  MME:
    LMDA: 0.1
  NAME: ZeroshotCLIP3
  SE:
    CONF_THRE: 0.95
    EMA_ALPHA: 0.999
    RAMPUP: 300
USE_CUDA: True
VERBALIZER:
  DIR: /ihome/yufeihuang/jiy130/Prompt/CoOp/knowledgebase/DescribableTextures
  SIZE: 10
VERBOSE: True
VERSION: 1
Collecting env info ...
** System info **
PyTorch version: 1.13.1
Is debug build: False
CUDA used to build PyTorch: 11.7
ROCM used to build PyTorch: N/A

OS: Red Hat Enterprise Linux (x86_64)
GCC version: (GCC) 4.8.5 20150623 (Red Hat 4.8.5-44)
Clang version: Could not collect
CMake version: Could not collect
Libc version: glibc-2.17

Python version: 3.8.16 (default, Jan 17 2023, 23:13:24)  [GCC 11.2.0] (64-bit runtime)
Python platform: Linux-3.10.0-1160.71.1.el7.x86_64-x86_64-with-glibc2.17
Is CUDA available: True
CUDA runtime version: Could not collect
CUDA_MODULE_LOADING set to: LAZY
GPU models and configuration: 
GPU 0: NVIDIA A100-PCIE-40GB
GPU 1: NVIDIA A100-PCIE-40GB
GPU 2: NVIDIA A100-PCIE-40GB
GPU 3: NVIDIA A100-PCIE-40GB

Nvidia driver version: 515.65.01
cuDNN version: Could not collect
HIP runtime version: N/A
MIOpen runtime version: N/A
Is XNNPACK available: True

Versions of relevant libraries:
[pip3] numpy==1.23.5
[pip3] torch==1.13.1
[pip3] torchaudio==0.13.1
[pip3] torchvision==0.14.1
[conda] blas                      1.0                         mkl  
[conda] cudatoolkit               11.3.1               h2bc3f7f_2  
[conda] ffmpeg                    4.3                  hf484d3e_0    pytorch
[conda] mkl                       2021.4.0           h06a4308_640  
[conda] mkl-service               2.4.0            py38h7f8727e_0  
[conda] mkl_fft                   1.3.1            py38hd3c417c_0  
[conda] mkl_random                1.2.2            py38h51133e4_0  
[conda] numpy                     1.23.5           py38h14f4228_0  
[conda] numpy-base                1.23.5           py38h31eccc5_0  
[conda] pytorch                   1.13.1          py3.8_cuda11.7_cudnn8.5.0_0    pytorch
[conda] pytorch-cuda              11.7                 h778d358_3    pytorch
[conda] pytorch-mutex             1.0                        cuda    pytorch
[conda] torchaudio                0.13.1               py38_cu117    pytorch
[conda] torchvision               0.14.1               py38_cu117    pytorch
        Pillow (9.4.0)

Loading trainer: ZeroshotCLIP3
Loading dataset: DescribableTextures
Reading split from /ix/yufeihuang/jia/nlp/prompt/data/dtd/split_zhou_DescribableTextures.json
Building transform_train
+ random resized crop (size=(224, 224), scale=(0.08, 1.0))
+ random flip
+ to torch tensor of range [0, 1]
+ normalization (mean=[0.48145466, 0.4578275, 0.40821073], std=[0.26862954, 0.26130258, 0.27577711])
Building transform_test
+ resize the smaller edge to 224
+ 224x224 center crop
+ to torch tensor of range [0, 1]
+ normalization (mean=[0.48145466, 0.4578275, 0.40821073], std=[0.26862954, 0.26130258, 0.27577711])
---------  -------------------
Dataset    DescribableTextures
# classes  47
# train_x  2,820
# val      1,128
# test     1,692
---------  -------------------
['banded', 'blotchy', 'braided', 'bubbly', 'bumpy', 'chequered', 'cobwebbed', 'cracked', 'crosshatched', 'crystalline', 'dotted', 'fibrous', 'flecked', 'freckled', 'frilly', 'gauzy', 'grid', 'grooved', 'honeycombed', 'interlaced', 'knitted', 'lacelike', 'lined', 'marbled', 'matted', 'meshed', 'paisley', 'perforated', 'pitted', 'pleated', 'polka-dotted', 'porous', 'potholed', 'scaly', 'smeared', 'spiralled', 'sprinkled', 'stained', 'stratified', 'striped', 'studded', 'swirly', 'veined', 'waffled', 'woven', 'wrinkled', 'zigzagged']
Loading CLIP (backbone: RN50)
Selected examples (mixed) [2167, 1874, 2336, 2797, 1276, 79, 1537, 1095, 1925, 917, 1376, 1650, 108, 1735, 2341, 1397, 1806, 539, 682, 2692, 2233, 30, 1716, 2630, 2246, 138, 1256, 239, 1717, 2285, 883, 679, 2467, 1425, 1346, 2767, 1111, 1132, 1872, 1472, 1560, 416, 1648, 1153, 1693, 1220, 348, 2549, 1521, 1015, 865, 1585, 78, 1808, 713, 1981, 1175, 1324, 1538, 2025, 1782, 882, 2024, 2210, 1996, 2444, 26, 1718, 459, 1207, 1160, 2469, 951, 2804, 911, 148, 789, 822, 66, 441, 2652, 1811, 2760, 1038, 2378, 2400, 1386, 1980, 2026, 468, 272, 1759, 87, 2502, 2324, 786, 486, 2818, 1086, 1868, 412, 2043, 2169, 1055, 46, 448, 905, 1937, 2713, 1791, 832, 1302, 755, 1414, 797, 534, 165, 528, 748, 1389, 639, 2325, 973, 1608, 1308, 575, 2780, 1204, 1036, 2664, 2540, 835, 1173, 438, 1222, 336, 1933, 1021, 671, 2584, 1998, 1332, 2339, 1245, 80, 1473, 953, 1108, 1709, 1731, 617, 581, 507, 2192, 2096, 1369, 1049, 1353, 2195, 1343, 1788, 722, 1306, 1344, 2737, 1803, 1214, 230, 231, 2453, 880, 830, 2693, 958, 897, 2051, 656, 1721, 2267, 1460, 879, 1393, 1764, 913, 498, 234, 1254, 2423, 1200, 1883, 2724, 2694, 2049, 1615, 2732, 27, 2214, 1244, 701, 584]
Building transform_test
+ resize the smaller edge to 224
+ 224x224 center crop
+ to torch tensor of range [0, 1]
+ normalization (mean=[0.48145466, 0.4578275, 0.40821073], std=[0.26862954, 0.26130258, 0.27577711])
Load support dataloader successfully! size: 200
num of org label words: 429
cali text features shape: torch.Size([429, 1024])
the calibration logits is tensor([[11.5938, 13.0078, 12.5469,  ..., 11.3203, 13.1797, 13.6953],
        [16.4219, 18.1562, 16.3906,  ..., 15.9141, 15.8828, 15.7344],
        [20.7188, 19.2188, 16.7500,  ..., 22.0469, 19.7031, 19.3281],
        ...,
        [22.3281, 21.5000, 21.5000,  ..., 22.3281, 22.2656, 21.2500],
        [18.7344, 18.9062, 18.9844,  ..., 21.5312, 19.5156, 20.3750],
        [20.6562, 17.8750, 20.9688,  ..., 18.0156, 18.7969, 19.1094]],
       device='cuda:0', dtype=torch.float16, grad_fn=<MmBackward0>)
cc_logits shape: torch.Size([200, 429])
Phase 1 [11, 9, 7, 11, 10, 10, 7, 11, 11, 9, 4, 11, 9, 9, 10, 9, 10, 11, 11, 7, 8, 10, 10, 9, 11, 8, 8, 11, 9, 7, 1, 11, 9, 10, 10, 11, 5, 7, 10, 11, 9, 10, 11, 11, 8, 8, 9]

register_calibrate_logits starting shape: torch.Size([429])
logits shape -1 :429
rm_calibrate_ids: {384, 386, 388, 389, 264, 392, 138, 268, 398, 400, 401, 274, 402, 403, 150, 151, 152, 25, 154, 28, 36, 293, 294, 295, 39, 170, 177, 305, 179, 50, 182, 310, 59, 320, 64, 322, 66, 324, 321, 327, 328, 202, 203, 76, 206, 211, 216, 219, 221, 222, 223, 354, 357, 231, 360, 359, 234, 106, 362, 361, 367, 368, 121, 378}, shape 64
Phase 2 [11, 9, 6, 9, 9, 9, 5, 10, 11, 9, 4, 10, 9, 8, 9, 9, 6, 11, 8, 6, 8, 8, 8, 4, 9, 8, 8, 11, 7, 6, 1, 11, 6, 9, 9, 5, 5, 7, 10, 5, 7, 9, 6, 6, 8, 8, 9]

num of label words after cc: 366
cali_logits shape: torch.Size([366])
Prompts: ['banded texture.', 'strip texture.', 'ring texture.', 'music texture.', 'stripe texture.', 'collar texture.', 'slip texture.', 'bar texture.', 'strap texture.', 'belt texture.', 'musical texture.', 'blotchy texture.', 'splotched texture.', 'blemished texture.', 'purplish texture.', 'discolored texture.', 'splotchy texture.', 'itchy texture.', 'grayish texture.', 'pigmented texture.', 'braided texture.', 'weave texture.', 'tress texture.', 'pigtail texture.', 'rope texture.', 'braiding texture.', 'bubbly texture.', 'effervescent texture.', 'champagne texture.', 'lively texture.', 'vivacious texture.', 'sassy texture.', 'fizzy texture.', 'cheerful texture.', 'foamy texture.', 'bumpy texture.', 'arduous texture.', 'uneven texture.', 'jolting texture.', 'jumpy texture.', 'jolty texture.', 'unsmooth texture.', 'slippery texture.', 'rutted texture.', 'chequered texture.', 'checkered texture.', 'checked texture.', 'visored texture.', 'shah texture.', 'woolrich texture.', 'persian language texture.', 'plumed texture.', 'varied texture.', 'cobwebbed texture.', 'spider texture.', 'miasma texture.', 'toadstool texture.', 'spinneret texture.', 'cracked texture.', 'check texture.', 'go texture.', 'chap texture.', 'chink texture.', 'fracture texture.', 'gap texture.', 'change texture.', 'cocaine texture.', 'fissure texture.', 'crosshatched texture.', 'hatch texture.', 'hatching texture.', 'hachure texture.', 'drawing texture.', 'monochromatic texture.', 'shading texture.', 'shade texture.', 'heraldic texture.', 'tincture texture.', 'blazon texture.', 'crystalline texture.', 'crystal texture.', 'pellucid texture.', 'limpid texture.', 'crystal clear texture.', 'lucid texture.', 'polycrystalline texture.', 'clear texture.', 'distinct texture.', 'dotted texture.', 'sprinkle texture.', 'dit texture.', 'stud texture.', 'fibrous texture.', 'stringy texture.', 'tough texture.', 'hempen texture.', 'sinewy texture.', 'rayon texture.', 'nylon texture.', 'cellulose texture.', 'polymeric texture.', 'synthetic fiber texture.', 'flecked texture.', 'speckle texture.', 'stain texture.', 'scurf texture.', 'chip texture.', 'flake texture.', 'dapple texture.', 'patch texture.', 'bit texture.', 'freckled texture.', 'lentigo texture.', 'macule texture.', 'blotch texture.', 'birthmark texture.', 'pimple texture.', 'cutis texture.', 'zit texture.', 'frilly texture.', 'ruffled texture.', 'adorned texture.', 'decorated texture.', 'dainty texture.', 'slinky texture.', 'demure texture.', 'flowered texture.', 'ladylike texture.', 'gauzy texture.', 'diaphanous texture.', 'filmy texture.', 'vaporous texture.', 'sheer texture.', 'cobwebby texture.', 'see-through texture.', 'thin texture.', 'billowy texture.', 'grid texture.', 'gridiron texture.', 'reference grid texture.', 'transformer texture.', 'shape texture.', 'system texture.', 'grooved texture.', 'rut texture.', 'furrow texture.', 'dado texture.', 'channel texture.', 'rhythm texture.', 'stria texture.', 'tempo texture.', 'funk texture.', 'riff texture.', 'track texture.', 'honeycombed texture.', 'beehive texture.', 'bee texture.', 'hexagonal texture.', 'tessellation texture.', 'cylindrical texture.', 'lattice texture.', 'container texture.', 'interlaced texture.', 'twine texture.', 'entwine texture.', 'enlace texture.', 'foliate texture.', 'distort texture.', 'knitted texture.', 'yarn texture.', 'silk texture.', 'wool texture.', 'weaving texture.', 'sew texture.', 'needlework texture.', 'stitch texture.', 'lacelike texture.', 'lacy texture.', 'fancy texture.', 'like texture.', 'likable texture.', 'bootlace texture.', 'shoelace texture.', 'velcro texture.', 'lined texture.', 'railway texture.', 'cable texture.', 'trace texture.', 'bloodline texture.', 'wrinkle texture.', 'route texture.', 'billet texture.', 'marbled texture.', 'sculpture texture.', 'calcium carbonate texture.', 'tile texture.', 'matted texture.', 'felt texture.', 'floor texture.', 'pad texture.', 'canvas texture.', 'tatami texture.', 'carpet texture.', 'tangle texture.', 'flat texture.', 'meshed texture.', 'net texture.', 'interlocking texture.', 'enmesh texture.', 'network texture.', 'operate texture.', 'meshwork texture.', 'engage texture.', 'paisley texture.', 'damask texture.', 'shantung texture.', 'jacquard texture.', 'faille texture.', 'georgette texture.', 'satin texture.', 'sateen texture.', 'perforated texture.', 'pierce texture.', 'permeate texture.', 'cut texture.', 'penetrate texture.', 'punch texture.', 'pierced texture.', 'punctured texture.', 'interpenetrate texture.', 'poke into texture.', 'paper texture.', 'pitted texture.', 'cavity texture.', 'mine texture.', 'hollow texture.', 'area texture.', 'pock texture.', 'fossa texture.', 'pleated texture.', 'tuck texture.', 'ruffle texture.', 'crimp texture.', 'bend texture.', 'flexure texture.', 'polka-dotted texture.', 'porous texture.', 'permeable texture.', 'leaky texture.', 'impermeable texture.', 'holey texture.', 'poriferous texture.', 'porose texture.', 'impenetrable texture.', 'hydrophilic texture.', 'penetrating texture.', 'dense texture.', 'potholed texture.', 'chuckhole texture.', 'carriageway texture.', 'macadam texture.', 'gridlock texture.', 'pavement texture.', 'scaly texture.', 'furry texture.', 'scaled texture.', 'scabrous texture.', 'lepidote texture.', 'leprose texture.', 'scurfy texture.', 'armored texture.', 'armoured texture.', 'smeared texture.', 'daub texture.', 'smirch texture.', 'slander texture.', 'smudge texture.', 'calumny texture.', 'discredit texture.', 'defame texture.', 'vilification texture.', 'spiralled texture.', 'inflation texture.', 'air texture.', 'cost texture.', 'price texture.', 'sprinkled texture.', 'splosh texture.', 'spatter texture.', 'drizzle texture.', 'moisten texture.', 'stained texture.', 'tarnish texture.', 'discoloration texture.', 'dye texture.', 'fleck texture.', 'smear texture.', 'dirt texture.', 'stratified texture.', 'differentiate texture.', 'distinguish texture.', 'interstratify texture.', 'reanalyze texture.', 'fertilize texture.', 'arrange texture.', 'lay texture.', 'place texture.', 'pose texture.', 'striped texture.', 'band texture.', 'banding texture.', 'streak texture.', 'military texture.', 'studded texture.', 'stallion texture.', 'rivet texture.', 'scantling texture.', 'studhorse texture.', 'stud poker texture.', 'man texture.', 'swirly texture.', 'multicolored texture.', 'wavy texture.', 'wiggly texture.', 'psychedelic texture.', 'swirl texture.', 'mussy texture.', 'weird texture.', 'dreamy texture.', 'veined texture.', 'artery texture.', 'heart texture.', 'jugular texture.', 'venous texture.', 'vena labialis texture.', 'waffled texture.', 'cake texture.', 'pancake texture.', 'waver texture.', 'batter texture.', 'hover texture.', 'woven texture.', 'thread texture.', 'twill texture.', 'weft texture.', 'braid texture.', 'interweave texture.', 'meander texture.', 'wander texture.', 'wrinkled texture.', 'rumple texture.', 'crumple texture.', 'line texture.', 'crease texture.', 'pucker texture.', 'crinkle texture.', 'seam texture.', 'zigzagged texture.', 'zag texture.', 'zig texture.', 'zig-zag texture.', 'crank texture.', 'crooked texture.', 'sinuous texture.', 'twisting texture.', 'parabola texture.']
text feature size: torch.Size([366, 1024])
Loading evaluator: Classification
Note that load_model() is skipped as no pretrained model is given (ignore this if it's done on purpose)
Evaluate on the *test* set
=> result
* total: 1,692
* correct: 443
* accuracy: 26.2%
* error: 73.8%
* macro_f1: 20.2%
